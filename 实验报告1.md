# 实验报告1

## 实验任务


## 定时的方案

前三次实验的重点内容是在程序中实现延时或定时的操作。对于单片机来说，实现计时功能的方法大致有以下两种：
    
    1. 让处理器执行特点数量的指令，通过指令占用处理器周期来实现延时的功能；
    
    2. 通过定时器和时钟信号进行计时。

由于PIC单片机的处理器设计较为简单，指令的执行周期是固定的。因此通过在汇编中设置循环，在给定初值的情况下，循环的执行数量和每次循环的指令周期都是可以完全可控的。这样就可以通过循环嵌套的方法，占用给定的处理器指令周期以此达到延时的目的。

但是，对于更先进的处理器，由于流水线、分支预测、超标量执行的原因，每条指令占用的处理器周期是不确定的，如果继续通过循环嵌套的方法，就会难以准确占用指定数量的指令周期，无法获得准确的延时（甚至可能直接被编译器优化掉）。因此需要使用到硬件定时器来获得准确的时间（时钟周期）。更为严重的问题是，在通过执行空循环进行延时时，处理器无法同时进行任何操作。

定时器结构图，略

本次使用的PIC单片机的TIMER0定时器，通过对其进行设置（后面会写），计数器会在输入指定个时钟信号后，产生溢出信号。处理器通过该溢出信号，就可以进行精确的定时操作。

## 定时器I/O 轮询 or 中断

如果将定时器的溢出视为一个特殊的I/O信号，那么检测这个信号的方法有轮询和中断两种。使用轮询的方法时，需要反复地去检测溢出标志位来判断定时器是否溢出。在PIC单片机中，一次标志位检测需要消耗至少三个指令周期（在部分情况下还需要进行banksel操作，以免读取了错误的内存地址，此时需要占用四个指令周期）。而且轮询和其他的操作不能同时在处理器上进行。因此，在采用轮询操作时，处理器既要消耗大量的指令周期去检测定时器溢出，在定时器溢出发生时，又不能保证第一时间发现。是一种时效性差，处理器效率低的操作。

在使用中断时，中断事件可以抢占正常的处理器工作流程，并通过中断向量进入中断服务程序。在使用中断时，处理器不需要反复检测信号，这样就可以处理其他事务。

通过中断逻辑图（Figure 7-1），通过定时器输入的中断信号属于内部中断，在对中断控制进行合适的使能后，在Timer0溢出时，寄存器TMR0IF会被置1，触发内部中断。




# 定时器设置

# 8bit

# 16bit
